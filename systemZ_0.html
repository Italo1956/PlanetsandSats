<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interplanetary Explorer | Misión Espacial Realista</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- VARIABLES CSS & RESET --- */
        :root {
            --primary: #00d4ff;
            --primary-glow: rgba(0, 212, 255, 0.6);
            --secondary: #ff00cc;
            --bg-dark: #050b14;
            --glass-bg: rgba(10, 20, 40, 0.85);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-main: #ffffff;
            --text-muted: #a5b4fc;
            --success: #00ff9d;
            --font-display: 'Orbitron', sans-serif;
            --font-body: 'Exo 2', sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Exo+2:wght@300;400;600&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font-body);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 50% 120%, #1a1a40 0%, #000 60%),
                url('https://upload.wikimedia.org/wikipedia/commons/9/99/NN_Serpentis_eclipsing_binary_star_system.gif'); /* Fondo sutil de galaxia */
            background-size: cover;
            background-attachment: fixed;
            background-blend-mode: overlay;
        }

        /* --- PANTALLA DE INICIO --- */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 1.5s ease;
        }

        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .splash-image {
            width: 90%;
            max-width: 1200px;
            height: 60vh;
            border-radius: 20px;
            overflow: hidden;
            border: 3px solid var(--primary);
            box-shadow: 0 0 50px var(--primary-glow);
            margin-bottom: 2rem;
        }

        .splash-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .splash-content {
            max-width: 900px;
            text-align: center;
            padding: 0 2rem;
        }

        .splash-title {
            font-family: var(--font-display);
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 0 20px var(--primary-glow);
        }

        .splash-text {
            font-size: 1.2rem;
            line-height: 1.8;
            color: var(--text-muted);
            margin-bottom: 2rem;
        }

        .splash-counter {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--success);
            margin-top: 1rem;
            text-shadow: 0 0 10px var(--success);
        }

        /* --- FONDO DE ESTRELLAS --- */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
        }

        .stars-container.warp .star {
            animation: warpSpeed 0.8s linear infinite;
            background: #aaddff;
            box-shadow: 0 0 4px white;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.4; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        @keyframes warpSpeed {
            0% { transform: translateY(0) scaleY(1); opacity: 1; }
            100% { transform: translateY(100vh) scaleY(20); opacity: 0; }
        }

        /* --- LAYOUT PRINCIPAL --- */
        .container { 
            max-width: 1600px; 
            margin: 0 auto; 
            padding: 2rem; 
            position: relative; 
            z-index: 1;
            opacity: 0;
            animation: fadeInMain 1s ease 6.5s forwards;
        }

        @keyframes fadeInMain {
            to { opacity: 1; }
        }

        header { text-align: center; /*margin-bottom: 3rem;*/ position: relative; }

        .brand { display: inline-flex; align-items: center; gap: 1.5rem; margin-bottom: 1rem; }

        .brand-icon {
            font-size: 3.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: drop-shadow(0 0 15px var(--primary-glow));
            animation: float 6s ease-in-out infinite;
        }

        h1 {
            font-family: var(--font-display);
            /*font-size: clamp(2rem, 5vw, 4rem);*/
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 900;
            text-shadow: 0 0 20px rgba(0,0,0,0.8);
        }

        .subtitle { font-size: 1.1rem; color: var(--text-muted); max-width: 700px; margin: 0 auto; line-height: 1.6; }

        .app-grid { display: grid; grid-template-columns: 350px 1fr; gap: 2rem; align-items: start; }
        @media (max-width: 1024px) { .app-grid { grid-template-columns: 1fr; } }

        /* --- PANELES --- */
        .panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 1rem;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
        }

        .panel-header {
            display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;
            padding-bottom: 1rem; border-bottom: 1px solid var(--glass-border);
            color: var(--primary); font-family: var(--font-display);
            font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px;
        }

        /* --- UI COMPONENTS --- */
        .avatar-upload { display: flex; flex-direction: column; align-items: center; gap: 1rem; margin-bottom: 2rem; }

        .avatar-frame {
            width: 150px; height: 150px; border-radius: 50%;
            border: 3px solid var(--primary); overflow: hidden;
            box-shadow: 0 0 20px var(--primary-glow);
            background: rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        
        .avatar-frame img { width: 100%; height: 100%; object-fit: cover; }

        .btn {
            background: linear-gradient(90deg, rgba(0, 212, 255, 0.1), rgba(0, 212, 255, 0.2));
            border: 1px solid var(--primary); color: var(--primary);
            padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer;
            font-family: var(--font-display); font-weight: 600;
            transition: all 0.3s ease; text-transform: uppercase; font-size: 0.85rem;
            display: inline-flex; align-items: center; gap: 0.5rem;
            justify-content: center;
        }
        .btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 20px var(--primary-glow); }
        .btn-secondary { border-color: var(--text-muted); color: var(--text-muted); background: transparent; }
        .btn-secondary:hover { background: rgba(255,255,255,0.1); color: #fff; box-shadow: none; }
        .btn-success { border-color: var(--success); color: var(--success); background: rgba(0, 255, 157, 0.1); }
        .btn-success:hover { background: var(--success); color: #000; box-shadow: 0 0 20px rgba(0, 255, 157, 0.6); }
        .btn-full { width: 100%; }

        .destinations-list {
            display: grid; grid-template-columns: 1fr; gap: 1rem;
            max-height: 350px; overflow-y: auto; margin-bottom: 2rem;
        }
        .destinations-list::-webkit-scrollbar { width: 6px; }
        .destinations-list::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }

        .planet-card {
            background: rgba(255,255,255,0.03); border: 1px solid transparent;
            border-radius: 12px; padding: 5px; display: flex; align-items: center; gap: 1rem;
            cursor: pointer; transition: all 0.3s ease;
        }
        .planet-card:hover { background: rgba(255,255,255,0.08); transform: translateX(5px); }
        .planet-card.selected {
            border-color: var(--secondary); background: rgba(255, 0, 204, 0.1);
            box-shadow: 0 0 15px rgba(255, 0, 204, 0.2);
        }

        .planet-icon { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: rgba(0,0,0,0.3); font-size: 1.5rem; }
        .planet-info h4 { font-family: var(--font-display); color: #fff; margin-bottom: 0.2rem; }
        .planet-info span { font-size: 0.8rem; color: var(--text-muted); }

        .system-log {
            background: #000; border: 1px solid #333; border-radius: 8px;
            height: 90px; overflow-y: auto; padding: 10px;
            font-family: 'Courier New', monospace; font-size: 0.8rem; color: var(--success);
            margin-bottom: 1rem; box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
        }
        .log-entry { margin-bottom: 4px; opacity: 0.8; border-bottom: 1px solid #111; padding-bottom: 2px; }
        .log-entry:last-child { opacity: 1; color: #fff; text-shadow: 0 0 5px var(--success); border-color: var(--primary); }
        .log-time { color: var(--text-muted); margin-right: 8px; font-weight: bold; }

        /* --- VISUALIZACIÓN Y CARRUSEL --- */
        .stage-display { min-height: 700px; display: flex; flex-direction: column; }

        .stage-content { 
            flex: 1; display: none; grid-template-columns: 800px 1fr; gap: 2rem;
            height: 100%; animation: fadeIn 0.8s ease; 
        }
        .stage-content.active { display: grid; }
        @media (max-width: 1024px) { .stage-content.active { grid-template-columns: 1fr; } }

        .visual-window {
            width: 100%;
            max-width: 100%;
            background: #000; border: 2px solid var(--primary); border-radius: 16px;
            overflow: hidden; position: relative; height: 450px;
            display: flex; flex-direction: column;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.15);
        }

        /* Estilos para el carrusel */
        .carousel-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .carousel-slides {
            display: flex;
            width: 300%; /* 3 imágenes = 300% */
            height: 100%;
            transition: transform 0.5s ease-in-out;
        }

        .carousel-slide {
            width: 33.3333%; /* 100% / 3 */
            height: 100%;
            flex-shrink: 0;
        }

        .carousel-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: #000;
        }

        /* Controles del carrusel */
        .carousel-controls {
            position: absolute;
            bottom: 15px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 10px;
            z-index: 10;
        }

        .carousel-btn {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .carousel-btn:hover {
            background: var(--primary);
            color: #000;
            transform: scale(1.1);
        }

        .carousel-indicators {
            position: absolute;
            bottom: 70px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 8px;
            z-index: 10;
        }

        .carousel-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .carousel-indicator.active {
            background: var(--primary);
            transform: scale(1.2);
        }

        /* Clave para que las imágenes reales se vean bien */
        .visual-window img {
            width: 100%; height: 100%; object-fit: contain;
            transition: transform 15s ease;
        }
        .visual-window:hover img { transform: scale(1.1); }

        .visual-overlay {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: linear-gradient(0deg, rgba(0,0,0,0.95), transparent);
            padding: 3rem 1.5rem 1.5rem; color: #fff;
            z-index: 5;
        }

        .info-window { display: flex; flex-direction: column; gap: 1.2rem; }

        .data-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .data-box {
            background: rgba(255,255,255,0.05); padding: 8px;
            border-left: 3px solid var(--primary); border-radius: 4px;
        }
        .data-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 5px; }
        .data-value { font-family: var(--font-display); font-size: 13px; color: #fff; }

        .mission-controls {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;
            margin-top: 1rem; padding-top: 1rem;
        }

        .progress-track { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-bottom: 1rem; position: relative; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); width: 0%; transition: width 0.8s ease; box-shadow: 0 0 10px var(--secondary); }

        .stage-controls-container {
            width: 500px;
            max-width: 100%;
            margin-top: 1.5rem;
        }

        .celebration {
            animation: celebrationPulse 2s ease-in-out infinite;
            text-shadow: 0 0 20px var(--success), 0 0 40px var(--success);
        }

        @keyframes celebrationPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        input[type="file"] { display: none; }
        .btn:disabled, .planet-card.disabled { opacity: 0.5; cursor: not-allowed; pointer-events: none; filter: grayscale(1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>
    <!-- PANTALLA DE INICIO (VIA LÁCTEA) -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-image">
            <img src="https://www.mundoprimaria.com/wp-content/uploads/2020/03/Via-lactea.jpg" alt="Vía Láctea">
        </div>
        <div class="splash-content">
            <h1 class="splash-title">VÍA LÁCTEA</h1>
            <div class="splash-text">
                En el universo hay millones de galaxias. Una de ellas es la que conocemos como Vía Láctea.<br>
                La Vía Láctea, formada por estrellas, polvo y gas, tiene forma de espiral. Podría decirse que su aspecto es algo así como un remolino con varios brazos; pues bien, en uno de ellos, el llamado brazo de Orión, se encuentra el Sistema Solar.
            </div>
            <div class="splash-counter" id="splashCounter">Iniciando en 15 segundos...</div>
        </div>
    </div>

    <div class="stars-container" id="starfield"></div>
    <div class="container">
        <header>
            <div class="brand">
                <i class="fas fa-user-astronaut brand-icon"></i>
                <div>
                    <h1>Interplanetary Explorer</h1>
                    <div class="subtitle">Simulador de Viaje Orbital con Telemetría en Tiempo Real</div>
                </div>
            </div>
        </header>
        <main class="app-grid">
            <section class="panel mission-panel">
                <div class="panel-header"><i class="fas fa-satellite-dish"></i><span>Mission Control</span></div>
                <div class="avatar-upload">
                    <div class="avatar-frame" id="avatarPreview">
                        <i class="fas fa-user" style="font-size: 3rem; color: #555; display: block; margin: 45px auto;"></i>
                    </div>
                    <label for="faceInput" class="btn btn-secondary btn-full"><i class="fas fa-camera"></i> Cargar Tripulantes</label>
                    <input type="file" id="faceInput" accept="image/*">
                </div>
                <div style="margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-globe"></i><span>Seleccionar Objetivo</span></div>
                <div class="destinations-list" id="destinationsList"></div>
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--glass-border);">
                    <div style="text-align: center; color: var(--text-muted); font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Los controles de misión aparecerán en la sección de visualización después de seleccionar un destino.
                    </div>
                </div>
            </section>
            <section class="panel stage-display" id="stageContainer">
                <div style="display: flex; flex-direction: column; height: 100%;">
                    <div class="stage-content active">
                        <div class="visual-window" style="width: 100%; max-width: 100%; height: 600px;">
                            <!-- Carrusel de imágenes -->
                            <div class="carousel-container" id="carouselContainer">
                                <div class="carousel-slides" id="carouselSlides">
                                    <div class="carousel-slide">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/2/22/Solar_System_graphic_by_NASA_%28wide%29.png" alt="Sistema Solar">
                                    </div>
                                    <div class="carousel-slide">
                                        <img src="https://www.mundoprimaria.com/wp-content/uploads/2020/03/Planetas-enanos.jpg" alt="Planetas Enanos">
                                    </div>
                                    <div class="carousel-slide">
                                        <img src="https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/todasLasLunas_16_9.gif" alt="Satélites y Planetas">
                                    </div>
                                </div>
                                <div class="carousel-indicators" id="carouselIndicators">
                                    <div class="carousel-indicator active" data-slide="0"></div>
                                    <div class="carousel-indicator" data-slide="1"></div>
                                    <div class="carousel-indicator" data-slide="2"></div>
                                </div>
                                <div class="carousel-controls">
                                    <button class="carousel-btn" id="carouselPrev">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <button class="carousel-btn" id="carouselNext">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="visual-overlay">
                                <h2 style="font-family: var(--font-display); color: var(--primary);" id="carouselTitle">SISTEMA SOLAR</h2>
                                <span style="font-size: 0.9rem; color: #ccc;" id="carouselSubtitle">VISTA COMPLETA // PLANETAS Y ÓRBITAS</span>
                            </div>
                        </div>
                        <div class="info-window" style="display: flex; align-items: center; justify-content: center; text-align: center;">
                            <div>
                                <h3 style="color: var(--text-muted); margin-bottom: 1rem;">El Sol y los planetas</h3>
                                <p style="color: var(--text-muted);">El Sol es una estrella inmensa que emite luz y calor y todo gira en torno a él: planetas, satelites, asteroides, etc., este movimiento se llama Traslación.
                                El Sol es el gran protagonista de este sistema, por eso se llama Sistema Solar y contiene
                                ocho planetas sólidos de forma casi esferoidal. 
                                Por orden, de más cercano a más lejano del Sol, los planetas son: Mercurio, Venus, Tierra, Marte, Júpiter, Saturno, Urano y Neptuno. Tambien existen existen cinco planetas enanos: Ceres, Eris,  Makemake, Haumea y Plutón y mas de 280 satelites naturales que giran alrededor de estos planetas tal como lo hace la Luna en la Tierra. Los planetas giran también sobre su propio eje y este movimiento se llama Rotación. El giro completo de la Tierra dura 24 horas y se le llama día.</p>
                            </div>
                            <div>
                                <i class="fas fa-satellite" style="font-size: 5rem; margin-bottom: 1rem; opacity: 0.3; color: var(--text-muted);"></i>
                                <h3 style="color: var(--text-muted); margin-bottom: 1rem;">Selecciona un destino</h3>
                                <p style="color: var(--text-muted);">y carga la identidad del tripulante para iniciar la misión.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        /* --- VARIABLES GLOBALES PARA EL CARRUSEL --- */
        let currentSlide = 0;
        const totalSlides = 3;
        const carouselTitles = [
            "SISTEMA SOLAR",
            "PLANETAS ENANOS",
            "SATÉLITES NATURALES"
        ];
        const carouselSubtitles = [
            "VISTA COMPLETA // PLANETAS Y ÓRBITAS",
            "CERES, PLUTÓN, ERIS, MAKEMAKE,HAUMEA",
            "LUNAS Y SATÉLITES // ORBITANDO PLANETAS"
            
        ];
        const carouselDescriptions = [
            "El Sol es una estrella inmensa que emite luz y calor y todo gira en torno a él: planetas, satelites, asteroides, etc., este movimiento se llama Traslación. El Sol es el gran protagonista de este sistema, por eso se llama Sistema Solar y contiene ocho planetas sólidos de forma casi esferoidal. Por orden, de más cercano a más lejano del Sol, los planetas son: Mercurio, Venus, Tierra, Marte, Júpiter, Saturno, Urano y Neptuno además también contiene cinco planetas enanos descubiertos hasta ahora.",
            "Los planetas enanos son cuerpos celestes que orbitan alrededor del Sol y tienen suficiente masa para tener forma esférica, pero no han limpiado su órbita de otros objetos. Los cinco planetas enanos reconocidos son: Ceres (en el cinturón de asteroides), Plutón, Haumea, Makemake y Eris (en el cinturón de Kuiper).",
            "Los satélites naturales, o lunas, son cuerpos celestes que orbitan alrededor de un planeta. Actualmente se han encontrado mas de 280 satelites en nuestro sistema. La Tierra tiene a la Luna, pero algunos planetas como Júpiter y Saturno tienen docenas de satélites. Estos satélites varían en tamaño desde pequeños asteroides hasta cuerpos casi planetarios como Ganímedes de Júpiter, la luna más grande del sistema solar."
            
        ];

        /* --- FUNCIONES DEL CARRUSEL --- */
        function initCarousel() {
            const carouselSlides = document.getElementById('carouselSlides');
            const carouselIndicators = document.getElementById('carouselIndicators');
            const carouselTitle = document.getElementById('carouselTitle');
            const carouselSubtitle = document.getElementById('carouselSubtitle');
            const carouselPrev = document.getElementById('carouselPrev');
            const carouselNext = document.getElementById('carouselNext');
            const infoWindow = document.querySelector('.info-window');

            // Actualizar carrusel según slide actual
            function updateCarousel() {
                // Mover slides
                carouselSlides.style.transform = `translateX(-${currentSlide * 33.3333}%)`;
                
                // Actualizar indicadores
                document.querySelectorAll('.carousel-indicator').forEach((indicator, index) => {
                    if (index === currentSlide) {
                        indicator.classList.add('active');
                    } else {
                        indicator.classList.remove('active');
                    }
                });
                
                // Actualizar títulos
                carouselTitle.textContent = carouselTitles[currentSlide];
                carouselSubtitle.textContent = carouselSubtitles[currentSlide];
                
                // Actualizar descripción en el info-window
                if (infoWindow) {
                    infoWindow.innerHTML = `
                        <div>
                            <h3 style="color: var(--text-muted); margin-bottom: 1rem;">${carouselTitles[currentSlide]}</h3>
                            <p style="color: var(--text-muted);">${carouselDescriptions[currentSlide]}</p>
                        </div>
                        <div>
                            <i class="fas fa-${currentSlide === 0 ? 'sun' : currentSlide === 1 ? 'moon' : 'globe-americas'}" style="font-size: 5rem; margin-bottom: 1rem; opacity: 0.3; color: var(--text-muted);"></i>
                            <h3 style="color: var(--text-muted); margin-bottom: 1rem;">Selecciona un destino</h3>
                            <p style="color: var(--text-muted);">y carga la identidad del tripulante para iniciar la misión.</p>
                        </div>
                    `;
                }
            }

            // Event listeners para controles
            carouselPrev.addEventListener('click', () => {
                currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
                updateCarousel();
            });

            carouselNext.addEventListener('click', () => {
                currentSlide = (currentSlide + 1) % totalSlides;
                updateCarousel();
            });

            // Event listeners para indicadores
            document.querySelectorAll('.carousel-indicator').forEach((indicator, index) => {
                indicator.addEventListener('click', () => {
                    currentSlide = index;
                    updateCarousel();
                });
            });

            // Auto-avance del carrusel cada 8 segundos
            let carouselInterval = setInterval(() => {
                currentSlide = (currentSlide + 1) % totalSlides;
                updateCarousel();
            }, 20000);

            // Pausar auto-avance al hacer hover
            const carouselContainer = document.getElementById('carouselContainer');
            carouselContainer.addEventListener('mouseenter', () => {
                clearInterval(carouselInterval);
            });

            carouselContainer.addEventListener('mouseleave', () => {
                carouselInterval = setInterval(() => {
                    currentSlide = (currentSlide + 1) % totalSlides;
                    updateCarousel();
                }, 20000);
            });

            // Inicializar carrusel
            updateCarousel();
        }

        /* --- PANTALLA DE INICIO --- */
        let seconds = 15;
        const splashScreen = document.getElementById('splashScreen');
        const splashCounter = document.getElementById('splashCounter');
        
        function updateCounter() {
            splashCounter.textContent = `Iniciando en ${seconds} segundos...`;
            seconds--;
            
            if (seconds >= 0) {
                setTimeout(updateCounter, 1000);
            } else {
                splashScreen.classList.add('fade-out');
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                }, 1500);
            }
        }
        
        // Iniciar contador
        setTimeout(updateCounter, 1000);

        /* --- BASE DE DATOS DE IMÁGENES ESPECÍFICAS POR PLANETA Y FASE --- */
        const PLANET_SPECIFIC_IMAGES = {
            mercury: {
                orbital_insertion: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mercury/mercurioinsercionbepicolombo1.gif',
                atmospheric_entry: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mercury/exploracion1.gif',
                exploration: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mercury/exploracionmercurio.png',
                return_prep: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mercury/exploracionmercurio.gif',
                return_launch: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mercury/finalizacionmercurio.gif'
            },
            venus: {
                orbital_insertion: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Venus/insercionOrbitalVenus.jpeg',
                landing: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Venus/landingvenus2.png',
                surface_exploration: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Venus/imagenSuperficieVenusexplorar.gif',
                return_prep: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Venus/preparacionVenus.png',
                return_launch: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Venus/takingofffromVenus.png'
            },
            mars: {
                orbital_insertion: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mars/insercionOrbitalMarte.jfif',
                landing: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mars/SpaceXStarshipMarsLandingon2.gif',
                surface_exploration: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mars/exploreMars.gif',
                return_prep: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mars/PreparacionMars3.png',
                return_launch: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mars/SpaceXStarshiptakesofffromMarsoncutter.com.gif'
            },
            jupiter: {
                orbital_insertion: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/jupiter/insercionOrbitaldeJunoaJupiter.gif',
                atmospheric_entry: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/jupiter/explorerJupiter.gif',
                exploration: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/jupiter/JupiterPIA22948.jpeg',
                return_prep: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/jupiter/exploracionJupiter2.gif',
                return_launch: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/jupiter/finalizacionJupiter.gif'
            },
            saturn: {
                orbital_insertion: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Saturno/InsercionOrbitalCassiniSaturno.gif',
                atmospheric_entry: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Saturno/exploracionsuperficieSaturno.gif',
                exploration: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Saturno/anillosdeSaturno.gif',
                return_prep: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Saturno/CorrientedelGloboSaturno.gif',
                return_launch: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Saturno/GranFinaleCassiniSaturno.gif'
            },
            uranus: {
                orbital_insertion: 'https://www.funkidslive.com/wp-content/uploads/2022/10/yto1u-i1pvi-1024x585.jpg',
                landing:'https://images-assets.nasa.gov/image/PIA18182/PIA18182~orig.jpg',
                surface_exploration: 'https://images-assets.nasa.gov/image/PIA18185/PIA18185~orig.jpg',
                return_prep: 'https://images-assets.nasa.gov/image/PIA18186/PIA18186~orig.jpg',
                return_launch: 'https://images-assets.nasa.gov/image/PIA18187/PIA18187~orig.jpg'
            },
            neptune: {
                orbital_insertion: 'https://www.sciencefriday.com/wp-content/uploads/2022/04/Neptune.jpg?w=1024',
                landing: 'https://images-assets.nasa.gov/image/PIA21449/PIA21449~orig.jpg',
                surface_exploration: 'https://images-assets.nasa.gov/image/PIA14632/PIA14632~orig.jpg',
                return_prep: 'https://images-assets.nasa.gov/image/PIA14633/PIA14633~orig.jpg',
                return_launch: 'https://images-assets.nasa.gov/image/PIA14634/PIA14634~orig.jpg'
            },
            cerus: {
                orbital_insertion: 'https://cdn.sci.news/images/enlarge/image_1710_1e-Ceres.jpg',
                landing: 'https://images-assets.nasa.gov/image/PIA21449/PIA21449~orig.jpg',
                surface_exploration:'https://images-assets.nasa.gov/image/PIA14632/PIA14632~orig.jpg',
                return_prep: 'https://images-assets.nasa.gov/image/PIA14633/PIA14633~orig.jpg',
                return_launch: 'https://images-assets.nasa.gov/image/PIA14634/PIA14634~orig.jpg'
            },
            pluto: {
                orbital_insertion: 'https://cdn.mos.cms.futurecdn.net/v2/t:0,l:420,cw:1080,ch:1080,q:80,w:1080/DoZSMXF87kCuzbymsuEFHo.jpg',
                landing: 'https://images-assets.nasa.gov/image/PIA21449/PIA21449~orig.jpg',
                surface_exploration: 'https://images-assets.nasa.gov/image/PIA14632/PIA14632~orig.jpg',
                return_prep: 'https://images-assets.nasa.gov/image/PIA14633/PIA14633~orig.jpg',
                return_launch: 'https://images-assets.nasa.gov/image/PIA14634/PIA14634~orig.jpg'
            },
            haumea: {
                orbital_insertion: 'https://daily.jstor.org/wp-content/uploads/2016/10/Haumea_1050x700.jpg',
                landing: 'https://images-assets.nasa.gov/image/PIA21449/PIA21449~orig.jpg',
                surface_exploration: 'https://images-assets.nasa.gov/image/PIA14632/PIA14632~orig.jpg',
                return_prep: 'https://images-assets.nasa.gov/image/PIA14633/PIA14633~orig.jpg',
                return_launch: 'https://images-assets.nasa.gov/image/PIA14634/PIA14634~orig.jpg'
            },
            makemake: {
                orbital_insertion: 'https://cdn.eso.org/images/screen/eso1246a.jpg',
                landing: 'https://cdn.eso.org/images/screen/eso1246a.jpg',
                surface_exploration: 'https://images-assets.nasa.gov/image/PIA14632/PIA14632~orig.jpg',
                return_prep: 'https://images-assets.nasa.gov/image/PIA14633/PIA14633~orig.jpg',
                return_launch: 'https://images-assets.nasa.gov/image/PIA14634/PIA14634~orig.jpg'
            },
            eris: {
                orbital_insertion: 'https://www.earth.com/assets/_next/image/?url=https%3A%2F%2Fcff2.earth.com%2Fuploads%2F2024%2F02%2F20135637%2FEris_icy-dwarf-planet_kuiper-belt_1m-1400x850.jpg&w=1080&q=75',
                landing: 'https://images-assets.nasa.gov/image/PIA21449/PIA21449~orig.jpg',
                surface_exploration: 'https://images-assets.nasa.gov/image/PIA14632/PIA14632~orig.jpg',
                return_prep: 'https://images-assets.nasa.gov/image/PIA14633/PIA14633~orig.jpg',
                return_launch: 'https://images-assets.nasa.gov/image/PIA14634/PIA14634~orig.jpg'
            },
            luna: {
                orbital_insertion: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Luna/despegueLuna.png',
                landing: 'https://actualidadaeroespacial.com/wp-content/uploads/2023/05/La-Nasa-selecciona-a-Blue-Origin-como-segundo-proveedor-de-modulo-de-aterrizaje-lunar-de-Artemisa-220523.jpg',
                surface_exploration: 'https://www.turismodeestrellas.com/m/p/770x410/media/files/3739_programa-artemis-luna-nasa.jpg',
                return_prep: 'https://conlagentenoticias.com/wp-content/uploads/2021/10/NASA-Luna.jpg',
                return_launch: "https://img.rtve.es/v/5341453?w=800&preview=1563220808420.jpg"
            },
            europa: {
                orbital_insertion: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Europa/insercionorbital1.png',
                landing: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Europa/preparacionretornoEuropa1.png',
                surface_exploration: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Europa/superficieeuropa-1.jpg',
                return_prep: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Europa/prepspacexmodulelaunchEuropa.png',
                return_launch: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Europa/insercionorbital.png'
            },
            ganymede: {
                orbital_insertion: 'https://danielmarin.naukas.com/files/2016/07/Captura-de-pantalla-2016-08-02-a-las-21.24.40.png',
                landing: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT3ZhIrEI4ylJY5YMa9IeiBcSc0eDzr3iSLLw&s',
                surface_exploration: 'https://images.fineartamerica.com/images-medium-large/artwork-of-jupiter-rising-above-ganymedes-surface-chris-butler.jpg',
                return_prep: 'https://external-preview.redd.it/umjOPU8XRvzpVolO6qIvFBiljBq4v8msNtTBjNZTtS0.png?width=640&crop=smart&auto=webp&s=b6927b23b3261b1b79a96e96617b8f423e2282a5',
                return_launch: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Ganimede/despeguedesdeganimedes.gif'
            }
        };

        /* --- IMÁGENES GENÉRICAS DE LA MISIÓN --- */
        const MISSION_IMAGES = {
            mercurio: "https://www.clarin.com/img/2017/07/06/BJgiWX3V-_1256x620.jpg",
            jupiter:'https://danielmarin.naukas.com/files/2016/07/PIA13255.jpg',
            saturno:'https://www.mdscc.nasa.gov/wp-content/uploads/2019/08/spacecraft01.jpg',
            suit: 'https://upload.wikimedia.org/wikipedia/commons/5/58/Technicians_assist_Gemini_7_prime_crew_in_systems_checks_%28s65-61835%29.jpg',
            launch: 'https://upload.wikimedia.org/wikipedia/commons/e/e9/45th_Space_Wing_Supports_Successful_Falcon_9_Starlink_L-22_Launch_%28210324-X-QO603-1004%29.jpg',
            transit: 'https://th-thumbnailer.cdn-si-edu.com/2s0k5EZVn4q-T0tkS-MBA3YzeN0=/1280x960/filters:focal(699x393:700x394)/https://tf-cmsv2-smithsonianmag-media.s3.amazonaws.com/filer/b2/68/b268b300-716e-4cec-8bec-ca552f5144bf/05y_on14_bbb_opener-1.jpg',
            earth_return: 'https://upload.wikimedia.org/wikipedia/commons/2/2c/North_America_from_low_orbiting_satellite_Suomi_NPP.jpg',
            reentry: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Starshipre-entryover%20Earth%E2%80%99scurvature.png',
            recovery: 'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/amarizaje.gif',
            celebration: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/Mobile_Quarantine_Facility_%28MQF%29_-_Ellington_AFB_%28EAFB%29%2C_TX_%28S69-40152%29.jpg/640px-Mobile_Quarantine_Facility_%28MQF%29_-_Ellington_AFB_%28EAFB%29%2C_TX_%28S69-40152%29.jpg',
            parade: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/Apollo_11_ticker_tape_parade_2.jpg/640px-Apollo_11_ticker_tape_parade_2.jpg'
        };

        /* --- DATOS DE MISIÓN --- */
        const MISSION_DATA = [
            {
                id: 'mercury',
                name: 'Mercurio',
                type: 'Planeta Rocoso',
                color: '#A5A5A5',
                icon: 'fa-temperature-high',
                distance: '0.39 AU',
                diametro: '4,879 km (38%)',
                travelTime: '~110 días',
                stats: { temp: '+430 °C a -167°C', gravity: '3.7 m/s²', day: '59 días' },
                desc: 'El planeta más pequeño. Carece de atmósfera significativa para retener el calor, por lo que sus noches son gélidas.',
                img: 'https://content.nationalgeographic.com.es/medio/2022/07/31/el-planeta-mercurio_3bcc14b3_1200x630.jpg'
            },
            {
                id: 'venus',
                name: 'Venus',
                type: 'Planeta Rocoso',
                color: '#E3BB76',
                icon: 'fa-cloud',
                distance: '0.72 AU',
                diametro: '12,104 km (95%)',
                travelTime: '~150 días',
                stats: { temp: '464°C', gravity: '8.87 m/s²', day: '243 días' },
                desc: 'Atmósfera densa de CO2 y nubes de ácido sulfúrico. Tiene el efecto invernadero más extremo del sistema solar. Es el planeta que mas brilla en el sisteme solar.',
                img: 'https://assets.science.nasa.gov/dynamicimage/assets/science/cds/general/images/2024/03/venus-mariner-10-pia23791-fig2.jpg?w=1096&h=1096&fit=clip&crop=faces%2Cfocalpoint'
            },
            {
                id: 'mars',
                name: 'Marte',
                type: 'Planeta Rocoso',
                color: '#FF5733',
                icon: 'fa-globe-americas',
                distance: '1.52 AU',
                diametro: '6,779 km (53%)',
                travelTime: '~210 días',
                stats: { temp: '-143 °C a 35 °C', gravity: '3.71 m/s²', day: '24h 37m' },
                desc: 'El Planeta Rojo. Hogar del Monte Olimpo y evidencia de agua líquida antigua.',
                img: /*'https://upload.wikimedia.org/wikipedia/commons/0/02/OSIRIS_Mars_true_color.jpg'*/'https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/Mars/Mars_Rotation.gif'
            },
            {
                id: 'jupiter',
                name: 'Júpiter',
                type: 'Gigante Gaseoso',
                color: '#D9A066',
                icon: 'fa-circle',
                distance: '5.20 AU',
                diametro: '139,820 km (1100%)',
                travelTime: '~5 años',
                stats: { temp: '-145°C', gravity: '24.79 m/s²', day: '9h 56m' },
                desc: 'Es el gigante del sistema solar lleno de tormentas. Su Gran Mancha Roja es una tormenta antigua más grande que la Tierra. Al ser un gigante gaseoso, no posee una superficie sólida, por tanto, no es posible aterrizar en Júpiter.',
                img: 'https://images-assets.nasa.gov/image/PIA22946/PIA22946~orig.jpg'
            },
            {
                id: 'saturn',
                name: 'Saturno',
                type: 'Gigante Gaseoso',
                color: '#EBD98F',
                icon: 'fa-ring',
                distance: '9.58 AU',
                diametro: '116,460 km (900%)',
                travelTime: '~4 años',
                stats: { temp: '-178 °C a -122°C', gravity: '10.44 m/s²', day: '10h 42m' },
                desc: 'Famoso por su espectacular sistema de anillos formados por partículas de hielo y roca.',
                img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Saturn_during_Equinox.jpg/1024px-Saturn_during_Equinox.jpg'
            },
            {
                id: 'uranus',
                name: 'Urano',
                type: 'Gigante de Hielo',
                color: '#4FD0E7',
                icon: 'fa-snowflake',
                distance: '19.18 AU',
                diametro: '50,724 km (400%)',
                travelTime: '~8 años',
                stats: { temp: '-195°C', gravity: '8.87 m/s²', day: '17h 14m' },
                desc: 'El séptimo planeta del sistema solar. Gira de lado con un ángulo de inclinación único de 98°.',
                img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Uranus2.jpg/1024px-Uranus2.jpg'
            },
            {
                id: 'neptune',
                name: 'Neptuno',
                type: 'Gigante de Hielo',
                color: '#3498DB',
                icon: 'fa-wind',
                distance: '30.07 AU',
                diametro: '49,244 km (390%)',
                travelTime: '~12 años',
                stats: { temp: '-218°C', gravity: '11.15 m/s²', day: '16h 6m' },
                desc: 'El planeta más distante del Sol. Conocido por sus fuertes vientos, los más rápidos del sistema solar.',
                img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Neptune_Full.jpg/1024px-Neptune_Full.jpg'
            },
            {
                id: 'cerus',
                name: 'Ceres',
                type: 'Roca y hielo, con evidencia de océano subsuperficial.',
                color: '#8B7355',
                icon: 'fa-globe',
                distance: '2.77 AU',
                diametro: '939 km (7%)',
                travelTime: '~1.5 años',
                stats: { temp: '-105°C', gravity: '0.28 m/s²', day: '9h 4m' },
                desc: 'El planeta enano más grande del cinturón de asteroides. Tiene un núcleo rocoso y un manto de hielo de agua.',
                img: 'https://cdn.sci.news/images/enlarge/image_1710_1e-Ceres.jpg'
            },
            {
                id: 'pluto',
                name: 'Plutón',
                type: 'Núcleo rocoso con manto de hielo de agua',
                color: '#D2B48C',
                icon: 'fa-snowflake',
                distance: '39.48 AU',
                diametro: '2,377 km (18%)',
                travelTime: '~9.5 años',
                stats: {  temp: '-229°C', gravity: '0.62 m/s²', day: '6d 9h' },
                desc: 'El planeta enano más famoso. Tiene una atmósfera delgada de nitrógeno, metano y monóxido de carbono que se congela y sublima.',
                img: 'https://cff2.earth.com/uploads/2024/05/23193331/pluto_vast-hidden-ocean_surface_1m.jpg'
            },
            {
                id: 'haumea',
                name: 'Haumea',
                type: 'Superficie brillante de hielo con una gran mancha roja',
                color: '#E6E6FA',
                icon: 'fa-football',
                distance: '43.13 AU',
                diametro: '2,322 km (≈ 18%)',
                travelTime: '~10 años',
                stats: { temp: '-241°C', gravity: '0.44 m/s²', day: '3h 55m' },
                desc: 'El planeta enano más extraño. Tiene forma ovalada debido a su rápida rotación. Posee dos lunas y un sistema de anillos. Su superficie está cubierta de hielo cristalino.',
                img: 'https://daily.jstor.org/wp-content/uploads/2016/10/Haumea_1050x700.jpg'
            },
            {
                id: 'makemake',
                name: 'Makemake',
                type: 'Mundo helado  de metano, etano y nitrógeno',
                color: '#DAA520',
                icon: 'fa-circle',
                distance: '45.79 AU',
                diametro: '1,430 km (11%)',
                travelTime: '~10.5 años',
                stats: { temp: '-243°C', gravity: '0.5 m/s²', day: '22h 30m'},
                desc: 'Este planeta enano, es el segundo objeto más brillante del cinturón de Kuiper después de Plutón. Tiene una superficie cubierta de metano congelado.',
                img: 'https://cff2.earth.com/uploads/2025/09/11114354/makemake_dwarf-planet_methane-gas-activity_1m.jpg'
            },
            {
                id: 'eris',
                name: 'Eris',
                type: 'Superficie extremadamente blanca y reflectante',
                color: '#A9A9A9',
                icon: 'fa-star',
                distance: '67.78 AU',
                diametro: '2,326 km (18%)',
                travelTime: '~15 años',
                stats: { temp: '-243°C', gravity: '0.82 m/s²', day: '25h 54m' },
                desc: 'El planeta enano más masivo y el segundo más grande. Su descubrimiento en 2005 llevó a la reclasificación de Plutón. Tiene una luna llamada Disnomia.',
                img: 'https://www.earth.com/assets/_next/image/?url=https%3A%2F%2Fcff2.earth.com%2Fuploads%2F2024%2F02%2F20135637%2FEris_icy-dwarf-planet_kuiper-belt_1m-1400x850.jpg&w=1080&q=75'
            },
            {
                id: 'luna',
                name: 'Luna',
                type: 'Luna de la Tierra',
                color: '#A2D9F7',
                icon: 'fa-moon',
                distance: '1.28 ls - 384MKm', // Segundos luz
                diametro: '3,474 km',
                travelTime: '~3 dias',
                stats: { temp: '-173°C a 127°C', gravity: '1.62 m/s²', day: '27.3 días' },
                desc: 'El único satélite natural de la Tierra y el quinto más grande del Sistema Solar. Sin atmósfera significativa, su superficie está cubierta de cráteres y mares basálticos. Es el único cuerpo celeste visitado por humanos.',
                img: 'https://img.freepik.com/foto-gratis/efecto-estilo-sepia-fase-luna-cielo-nocturno_23-2151793439.jpg?semt=ais_hybrid&w=740&q=80'
            },
            {
                id: 'europa',
                name: 'Europa',
                type: 'Luna de Júpiter',
                color: '#A2D9F7',
                icon: 'fa-snowflake',
                distance: '5.2 AU',
                diametro: '3,122 km',
                travelTime: '~3 años',
                stats: { temp: '-170°C', gravity: '1.31 m/s²', day: '3.5 días' },
                desc: 'Es uno de los satélites más grandes y fascinantes de Júpiter, famoso por su corteza y superficie de hielo liso. Se cree que debajo existe un vasto océano de agua salada líquida.',
                img: 'https://upload.wikimedia.org/wikipedia/commons/6/6c/PIA19048_realistic_color_Europa_mosaic_edited.jpg'
            },
            {
                id: 'ganymede',
                name: 'Ganímedes',
                type: 'Luna de Júpiter',
                color: '#5D8AA8',
                icon: 'fa-moon',
                distance: '5.2 AU',
                diametro: '5,268 km',
                travelTime: '~3 años (de Júpiter: 1.07M km)',
                stats: { temp: '-163°C', gravity: '1.428 m/s²', day: '7d 3h' },
                desc: 'La luna más grande del Sistema Solar, incluso más grande que Mercurio. Tiene su propio campo magnético y se cree que alberga un vasto océano subterráneo de agua salada bajo su corteza de hielo.',
                img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b5/Ganymede%2C_moon_of_Jupiter%2C_NASA.jpg/640px-Ganymede%2C_moon_of_Jupiter%2C_NASA.jpg'
            }
        ];

        const STAGES = [
            { id: 0, title: "Destino Seleccionado", desc: "Inicio de la Mision, cohete en la rampa." },
            { id: 1, title: "Preparación y Equipamiento", desc: "Revisión de sistemas y traje EVA en la rampa." },
            { id: 2, title: "Secuencia de Lanzamiento", desc: "Ignición de propulsores y ascenso atmosférico." },
            { id: 3, title: "Tránsito Interplanetario", desc: "Viaje de crucero en el vacío del espacio hacia el destino." },
            { id: 4, title: "Inserción Orbital", desc: "Frenado gravitatorio para captura orbital del objetivo." },
            { id: 5, title: "Descenso y Aterrizaje", desc: "Entrada atmosférica y toma de contacto en la superficie." },
            { id: 6, title: "Exploración en Superficie", desc: "Análisis geológico y recolección de muestras." },
            { id: 7, title: "Preparación para Retorno", desc: "Carga de muestras y verificación de sistemas de la nave." },
            { id: 8, title: "Despegue de Retorno", desc: "Ascenso desde la superficie del planeta hacia la órbita." },
            { id: 9, title: "Tránsito de Regreso", desc: "Viaje de retorno hacia la Tierra a través del espacio profundo." },
            { id: 10, title: "Reentrada en la Tierra", desc: "Ingreso atmosférico y desaceleración para aterrizaje." },
            { id: 11, title: "Recuperación de la Nave", desc: "Aterrizaje controlado y operaciones de recuperación." },
            { id: 12, title: "Cuarentena", desc: "¡Evitar posibles virus y bacterias extraterrestres!" },
            { id: 13, title: "Misión Cumplida", desc: "¡Celebración por el éxito de la misión interplanetaria!" }
        ];

        const state = { 
            currentStage: 0, 
            destination: null, 
            userImage: null,
            astronautName: "Tripulante"
        };
        
        const dom = {
            stars: document.getElementById('starfield'),
            destinations: document.getElementById('destinationsList'),
            avatarPreview: document.getElementById('avatarPreview'),
            stageContainer: document.getElementById('stageContainer'),
            inputFace: document.getElementById('faceInput')
        };

        let stageControls = {
            log: null,
            btnLaunch: null,
            btnNext: null,
            btnReset: null,
            progressBar: null,
            progressPercent: null,
            stageLabel: null
        };

        function init() {
            createStars();
            renderDestinations();
            setupEventListeners();
            initCarousel();
        }

        function createStars() {
            const count = 150;
            for(let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.width = `${Math.random() * 2 + 1}px`;
                star.style.height = star.style.width;
                star.style.setProperty('--duration', `${Math.random() * 3 + 2}s`);
                dom.stars.appendChild(star);
            }
        }

        /*function renderDestinations() {
            dom.destinations.innerHTML = MISSION_DATA.map(planet => `
                <div class="planet-card" onclick="selectPlanet('${planet.id}')">
                    <div class="planet-icon" style="color: ${planet.color}; border-color: ${planet.color}33;">
                        <i class="fas ${planet.icon}"></i>
                    </div>
                    <div class="planet-info">
                        <h4>${planet.name}</h4>
                        <span>${planet.type}</span>
                    </div>
                </div>
            `).join('');
        }*/

        function renderDestinations() {
    const planets = MISSION_DATA.slice(0, 12); // Planetas y planetas enanos (primeros 12)
    const satellites = MISSION_DATA.slice(12); // Satélites naturales (últimos 3)
    
    let html = '';
    
    // Renderizar planetas y planetas enanos
    planets.forEach(planet => {
        html += `
            <div class="planet-card" data-planet-id="${planet.id}" onclick="selectPlanet('${planet.id}')">
                <div class="planet-icon" style="color: ${planet.color}; border-color: ${planet.color}33;">
                    <i class="fas ${planet.icon}"></i>
                </div>
                <div class="planet-info">
                    <h4>${planet.name}</h4>
                    <span>${planet.type}</span>
                </div>
            </div>
        `;
    });
    
    // Agregar subtítulo para satélites naturales
    html += `
        <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--glass-border);" class="satellite-header">
            <div style="color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-moon"></i>
                <span>Satélites Naturales (Lunas)</span>
            </div>
        </div>
    `;
    
    // Renderizar satélites naturales
    satellites.forEach(satellite => {
        html += `
            <div class="planet-card" data-planet-id="${satellite.id}" onclick="selectPlanet('${satellite.id}')">
                <div class="planet-icon" style="color: ${satellite.color}; border-color: ${satellite.color}33;">
                    <i class="fas ${satellite.icon}"></i>
                </div>
                <div class="planet-info">
                    <h4>${satellite.name}</h4>
                    <span>${satellite.type}</span>
                </div>
            </div>
        `;
    });
    
    dom.destinations.innerHTML = html;
}

// Modifica la función selectPlanet para usar data attributes
window.selectPlanet = (id) => {
    state.destination = MISSION_DATA.find(p => p.id === id);
    
    // Remover la clase 'selected' de todas las tarjetas
    document.querySelectorAll('.planet-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // Agregar la clase 'selected' solo a la tarjeta clickeada
    const selectedCard = document.querySelector(`.planet-card[data-planet-id="${id}"]`);
    if (selectedCard) {
        selectedCard.classList.add('selected');
    }
    
    updateStageView();
};

        function handleImageUpload(e) {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (evt) => {
                    state.userImage = evt.target.result;
                    dom.avatarPreview.innerHTML = `<img src="${state.userImage}" alt="Astronauta">`;
                    state.astronautName = "Astronauta " + (Math.floor(Math.random() * 100) + 1);
                };
                reader.readAsDataURL(file);
            }
        }

        function launchMission() {
            if(!state.destination) return;
            state.currentStage = 1;
            dom.stars.classList.add('warp');
            setTimeout(() => {
                dom.stars.classList.remove('warp');
                updateStageView();
                /*logStage(`¡DESPEGUE CONFIRMADO! Rumbo a ${state.destination.name}.`);*/
                logStage(`Tripulante: ${state.astronautName}`);
            }, 1500);
        }

        function nextStage() {
            if(state.currentStage < STAGES.length -1) {
                state.currentStage++;
                updateStageView();
                /*logStage(`Fase ${state.currentStage-1} completada: ${STAGES[state.currentStage - 1].title}`);
                logStage(`Iniciando Fase ${state.currentStage}: ${STAGES[state.currentStage].title}`);*/
                
                if(state.currentStage === STAGES.length - 1) {
                    setTimeout(() => {
                        if(stageControls.log) {
                            logStage("🎉 ¡MISIÓN COMPLETADA EXITOSAMENTE!");
                            logStage(`¡Felicidades ${state.astronautName}! Has hecho historia.`);
                        }
                    }, 1000);
                }
            }
        }

        function resetMission() {
            
            state.currentStage = 0;
            state.destination = null;
            state.astronautName = "Tripulante";
            dom.stageContainer.innerHTML = `
                <div style="display: flex; flex-direction: column; height: 100%;">
                    <div class="stage-content active">
                        <div class="visual-window" style="width: 100%; max-width: 100%; height: 600px;">
                            <!-- Carrusel de imágenes -->
                            <div class="carousel-container" id="carouselContainer">
                                <div class="carousel-slides" id="carouselSlides">
                                    <div class="carousel-slide">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/2/22/Solar_System_graphic_by_NASA_%28wide%29.png" alt="Sistema Solar">
                                    </div>
                                    <div class="carousel-slide">
                                        <img src="https://www.mundoprimaria.com/wp-content/uploads/2020/03/Planetas-enanos.jpg" alt="Planetas Enanos">
                                    </div>
                                    <div class="carousel-slide">
                                        <img src="https://raw.githubusercontent.com/Italo1956/PlanetsandSats/refs/heads/main/todasLasLunas_16_9.gif" alt="Satélites y Planetas">
                                    </div> 
                                </div>
                                <div class="carousel-indicators" id="carouselIndicators">
                                    <div class="carousel-indicator active" data-slide="0"></div>
                                    <div class="carousel-indicator" data-slide="1"></div>
                                    <div class="carousel-indicator" data-slide="2"></div>
                                </div>
                                <div class="carousel-controls">
                                    <button class="carousel-btn" id="carouselPrev">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <button class="carousel-btn" id="carouselNext">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="visual-overlay">
                                <h2 style="font-family: var(--font-display); color: var(--primary);" id="carouselTitle">SISTEMA SOLAR</h2>
                                <span style="font-size: 0.9rem; color: #ccc;" id="carouselSubtitle">VISTA COMPLETA // PLANETAS Y ÓRBITAS</span>
                            </div>
                        </div>
                        <div class="info-window" style="display: flex; align-items: center; justify-content: center; text-align: center;">
                            <div>
                                <h3 style="color: var(--text-muted); margin-bottom: 1rem;">El Sol y los planetas</h3>
                                <p style="color: var(--text-muted);">El Sol es una estrella inmensa que emite luz y calor y todo gira en torno a él: planetas, satelites, asteroides, etc., este movimiento se llama Traslación.
                                El Sol es el gran protagonista de este sistema, por eso se llama Sistema Solar y contiene
                                ocho planetas sólidos de forma casi esferoidal. 
                                Por orden, de más cercano a más lejano del Sol, los planetas son: Mercurio, Venus, Tierra, Marte, Júpiter, Saturno, Urano y Neptuno. Tambien existen existen cinco planetas enanos: Ceres, Eris,  Makemake, Haumea y Plutón y mas de 280 satelites naturales que giran alrededor de estos planetas tal como lo hace la Luna en la Tierra. Los planetas giran también sobre su propio eje y este movimiento se llama Rotación. El giro completo de la Tierra dura 24 horas y se le llama día.</p>
                            </div>
                            <div>
                                <i class="fas fa-satellite" style="font-size: 5rem; margin-bottom: 1rem; opacity: 0.3; color: var(--text-muted);"></i>
                                <h3 style="color: var(--text-muted); margin-bottom: 1rem;">Selecciona un destino</h3>
                                <p style="color: var(--text-muted);">y carga la identidad del tripulante para iniciar la misión.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            dom.stars.classList.remove('warp');
            document.querySelectorAll('.planet-card').forEach(c => c.classList.remove('selected'));
            dom.avatarPreview.innerHTML = `<i class="fas fa-user" style="font-size: 3rem; color: #555; display: block; margin: 45px auto;"></i>`;
            state.userImage = null;
            
            setTimeout(initCarousel, 100);
        }

        function updateStageView() {
            if (!state.destination) {
                resetMission();
                return;
            }

            const STAGES = [
                { id: 0, title: "Destino Seleccionado", desc: "Inicio de la Mision, cohete en la rampa." },
                { id: 1, title: "Preparación y Equipamiento", desc: "Revisión de sistemas y traje EVA en la rampa." },
                { id: 2, title: "Secuencia de Lanzamiento", desc: "Ignición de propulsores y ascenso atmosférico." },
                { id: 3, title: "Tránsito Interplanetario", desc: "Viaje de crucero en el vacío del espacio hacia el destino." },
                { id: 4, title: "Inserción Orbital", desc: "Frenado gravitatorio para captura orbital del objetivo." },
                { id: 5, title: "Descenso y Aterrizaje", desc: "Entrada atmosférica y toma de contacto en la superficie." },
                { id: 6, title: "Exploración en Superficie", desc: "Análisis geológico y recolección de muestras." },
                { id: 7, title: "Preparación para Retorno", desc: "Carga de muestras y verificación de sistemas de la nave." },
                { id: 8, title: "Despegue de Retorno", desc: "Ascenso desde la superficie del planeta hacia la órbita." },
                { id: 9, title: "Tránsito de Regreso", desc: "Viaje de retorno hacia la Tierra a través del espacio profundo." },
                { id: 10, title: "Reentrada en la Tierra", desc: "Ingreso atmosférico y desaceleración para aterrizaje." },
                { id: 11, title: "Recuperación de la Nave", desc: "Aterrizaje controlado y operaciones de recuperación." },
                { id: 12, title: "Cuarentena", desc: "¡Evitar posibles virus y bacterias extraterrestres!" },
                { id: 13, title: "Misión Cumplida", desc: "¡Celebración por el éxito de la misión interplanetaria!" }
            ];

            const stage = STAGES[state.currentStage] || STAGES[0];
            const planet = state.destination;
            const planetImages = PLANET_SPECIFIC_IMAGES[planet.id];
            
            const progress = state.currentStage > 0 ? ((state.currentStage) / (STAGES.length - 1)) * 100 : 0;

            let visualContent = '';
            let infoContent = '';

            // Configuración de contenido según la fase
            if (state.currentStage === 0) {
                // Vista previa antes del lanzamiento
                visualContent = `<img src="${planet.img}" alt="${planet.name}">`;
                infoContent = `
                    <h2>${planet.name}</h2>
                    <p>${planet.desc}</p>
                    <p>${stage.desc}</p>
                    <div class="data-grid">
                        <div class="data-box"><div class="data-label">Distancia</div><div class="data-value">${planet.distance}</div></div>
                        <div class="data-box"><div class="data-label">Diametro</div><div class="data-value">${planet.diametro}</div></div>
                        <div class="data-box"><div class="data-label">Tiempo de Viaje</div><div class="data-value">${planet.travelTime}</div></div>
                        <div class="data-box"><div class="data-label">Temperatura</div><div class="data-value">${planet.stats.temp}</div></div>
                        <div class="data-box"><div class="data-label">Gravedad</div><div class="data-value">${planet.stats.gravity}</div></div>
                        <div class="data-box"><div class="data-label">Duración Día</div><div class="data-value">${planet.stats.day}</div></div>
                    </div>
                    <p style="color: var(--primary); margin-top: 0px;"><i class="fas fa-info-circle"></i> Todo listo para el lanzamiento. Presiona "Iniciar Misión" para comenzar.</p>
                `;
            } else if (state.currentStage === 1) {
                if(planet.id === 'jupiter') {
                    visualContent = `<img src="${MISSION_IMAGES.jupiter}" alt="Sonda June">`;
                    `<h3>Exploración Superficie</h3><p>Entrada atmosférica y toma de imagenes en la superficie</p>` ;
                    infoContent = `<h3>Protocolo Despegue June</h3><p>Revisión de los grandes paneles solares de la Sonda June para explorar el sistema solar exterior.</p><p>Preparando acceso a la plataforma de lanzamiento.</p><p>Verificaciones finales de sistemas, combustible y clima, asegurando que todo está en orden para el lanzamiento.</p>`;
                } else if(planet.id === 'saturn') {
                    visualContent = `<img src="${MISSION_IMAGES.saturno}" alt="Sonda Cassini">`;
                    `<h3>Exploración Superficie</h3><p>Entrada atmosférica y toma de imagenes en la superficie</p>`;
                    infoContent = `<h3>Protocolo Despegue Cassini</h3><p>Revisión Instrumental de la Sonda Cassini: radar, cámaras CCD, espectrómetros (luz visible, infrarroja, masa), analizador de polvo y magnetómetro.</p><p>Preparando acceso a la plataforma de lanzamiento.</p><p>Verificaciones finales de sistemas, combustible y clima, asegurando que todo está en orden para el lanzamiento.</p>`;
                } else if(planet.id === 'mercury') {
                    visualContent = `<img src="${MISSION_IMAGES.mercurio}" alt="BepiColombo">`;
                    `<h3>Exploración Superficie</h3><p>Entrada atmosférica y toma de imagenes en la superficie</p>`;
                    infoContent = `<h3>Protocolo Despegue Sonda BepiColombo</h3><p>Revisión Instrumental de la Sonda BepiColombo: con los modulos MMO (Orbitador Magnetosférico) y MPO (Orbitador Planetario) ensamblados en conjunto.</p><p>Preparando acceso a la plataforma de lanzamiento.</p><p>Verificaciones finales de sistemas, combustible y clima, asegurando que todo está en orden para el lanzamiento.</p>`;
                } else {
                visualContent = `<img src="${MISSION_IMAGES.suit}" alt="Astronauta">`;
                infoContent = `<h3>Protocolo Despegue</h3><p>${stage.desc}</p><p>Revisión de sellado del casco y niveles de Oxigeno.</p><p>Preparando acceso a la plataforma de lanzamiento.</p><p>Verificaciones finales de sistemas, combustible y clima, asegurando que todo está en orden para el lanzamiento.</p>`;}
            } else if (state.currentStage === 2) {
                visualContent = `<img src="${MISSION_IMAGES.launch}" alt="Lanzamiento">`;
                infoContent = `<h3>Ascenso Dinámico</h3><p>Se encienden los motores para generar suficiente empuje para superar el peso del cohete y la gravedad terrestre, comenzando el ascenso vertical.</p><p>Máxima presión dinámica (Max-Q) superada.</p><p>Acelerando hacia órbita terrestre baja.</p>`;
            } else if (state.currentStage === 3) {
                visualContent = `<img src="${MISSION_IMAGES.transit}" alt="Tránsito">`; 
                infoContent = `<h3>${stage.title}</h3><p>Viaje espacial entre planetas dentro de un mismo sistema solar.</p><p>Navegando en el espacio profundo lleno de polvo, plasma y campos magnéticos.</p><p>Objetivo: ${planet.name}. Distancia: ${planet.distance}.</p>`;
            } else if (state.currentStage === 4) {
                // FASE 4: Inserción Orbital 
                visualContent = `<img src="${planetImages.orbital_insertion}" alt="Inserción Orbital en ${planet.name}">`; 
                infoContent = `<h3>${stage.title} en ${planet.name}</h3><p>${stage.desc}</p><p>Realizando maniobra de frenado gravitatorio para ser capturado por la órbita de ${planet.name}.</p><p>Ajustando trayectoria para establecerse como satélite artificial de ${planet.name}.</p>`;
            } else if (state.currentStage === 5) {
                // FASE 5: Descenso y Aterrizaje o Exploracion Aerea de planetas gaseosos 
                if(planet.id === 'jupiter') {
                    visualContent = `<img src="${planetImages.atmospheric_entry}" alt="Entrada Atmosférica en ${planet.name}">`;
                    `<h3>Exploración Superficie</h3><p>Entrada atmosférica y toma de imagenes en la superficie</p>` ;
                    infoContent = `<h3>Inserción Atmosférica en ${planet.name}</h3><p>La nave sonda June desciende hacia la atmósfera superior del gigante gaseoso.</p><p>No hay superficie sólida para aterrizar. Iniciando recolección de datos atmosféricos con cámaras y sensores.</p>`;
                } else if(planet.id === 'saturn') {
                    visualContent = `<img src="${planetImages.atmospheric_entry}" alt="Entrada Atmosférica en ${planet.name}">`;
                    `<h3>Exploración Superficie</h3><p>Entrada atmosférica y toma de imagenes en la superficie</p>`;
                    infoContent = `<h3>Inserción Atmosférica en ${planet.name}</h3><p>La nave sonda Cassini desciende hacia la atmósfera superior del gigante gaseoso.</p><p>No hay superficie sólida para aterrizar. Iniciando recolección de datos atmosféricos con cámaras y sensores.</p>`;
                } else if(planet.id === 'mercury') {
                    visualContent = `<img src="${planetImages.atmospheric_entry}" alt="Entrada Atmosférica en ${planet.name}">`;
                    stage.title = "Exploración Superficie";
                    `<h3>${stage.title}</h3><p>Entrada atmosférica y toma de imagenes en la superficie</p>`;
                    infoContent = `<h3>Inserción Atmosférica en ${planet.name}</h3><p>La nave Sonda BepiColombo desciende hacia la atmósfera superior de Mercurio.</p><p>BepiColombo no aterrizará en Mercurio, su misión es orbitarlo. Las dos sondas MPO y MMO inician recolección de datos atmosféricos con cámaras y sensores.</p>`;
                } else {
                    visualContent = `<img src="${planetImages.landing}" alt="Aterrizaje en ${planet.name}">`;
                    infoContent = `<h3>${stage.title} en ${planet.name}</h3><p>${stage.desc}</p><p>${planet.desc}</p><p>Activando sistema de aterrizaje autónomo en la superficie de ${planet.name}.</p>`;
                }
            } else if (state.currentStage === 6) {
                // FASE 6: Exploración en Superficie 
                if(planet.id === 'jupiter') {
                    visualContent = `<img src="${planetImages.exploration}" alt="Exploración de ${planet.name}">`;
                    infoContent = `
                        <h3>Exploración Atmosférica de ${planet.name}</h3>
                        <p>${planet.desc}</p>
                        <div class="data-grid">
                            <div class="data-box"><div class="data-label">Temperatura</div><div class="data-value">${planet.stats.temp}</div></div>
                            <div class="data-box"><div class="data-label">Tiempo de Viaje</div><div class="data-value">${planet.travelTime}</div></div>
                            <div class="data-box"><div class="data-label">Gravedad</div><div class="data-value">${planet.stats.gravity}</div></div>
                            <div class="data-box"><div class="data-label">Duración Día</div><div class="data-value">${planet.stats.day}</div></div>
                            <div class="data-box"><div class="data-label">Distancia Solar</div><div class="data-value">${planet.distance}</div></div>
                            <div class="data-box"><div class="data-label">Diametro</div><div class="data-value">${planet.diametro}</div></div>
                        </div>
                        <p>Realizando análisis de composición atmosférica y de campos magnéticos.</p>`;
                     } else if(planet.id === 'saturn') {
                        visualContent = `<img src="${planetImages.exploration}" alt="Exploración de anillos de ${planet.name}">`;
                        stage.title = "Exploración de Anillos";
                        infoContent = `
                        <h3>Exploración Anillos de ${planet.name}</h3>
                        <p>${planet.desc}</p>
                        <div class="data-grid">
                            <div class="data-box"><div class="data-label">Temperatura</div><div class="data-value">${planet.stats.temp}</div></div>
                            <div class="data-box"><div class="data-label">Tiempo de Viaje</div><div class="data-value">${planet.travelTime}</div></div>
                            <div class="data-box"><div class="data-label">Gravedad</div><div class="data-value">${planet.stats.gravity}</div></div>
                            <div class="data-box"><div class="data-label">Duración Día</div><div class="data-value">${planet.stats.day}</div></div>
                            <div class="data-box"><div class="data-label">Distancia Solar</div><div class="data-value">${planet.distance}</div></div>
                            <div class="data-box"><div class="data-label">Diametro</div><div class="data-value">${planet.diametro}</div></div>
                        </div>
                        <p>Son sistemas impresionantes de hielo, roca y polvo que orbitan el planeta, compuestos por miles de millones de partículas que van desde granos microscópicos hasta rocas del tamaño de una casa.</p>
                    `;
                    } else if(planet.id === 'mercury') {
                        visualContent = `<img src="${planetImages.exploration}" alt="Exploración de ${planet.name}">`;
                        stage.title = "Exploración con sondas MMO y MPO";
                        infoContent = `
                        <h3>Exploración  de BepiColombo en ${planet.name}</h3>
                        <p>${planet.desc}</p>
                        <div class="data-grid">
                            <div class="data-box"><div class="data-label">Temperatura</div><div class="data-value">${planet.stats.temp}</div></div>
                            <div class="data-box"><div class="data-label">Tiempo de Viaje</div><div class="data-value">${planet.travelTime}</div></div>
                            <div class="data-box"><div class="data-label">Gravedad</div><div class="data-value">${planet.stats.gravity}</div></div>
                            <div class="data-box"><div class="data-label">Duración Día</div><div class="data-value">${planet.stats.day}</div></div>
                            <div class="data-box"><div class="data-label">Distancia Solar</div><div class="data-value">${planet.distance}</div></div>
                            <div class="data-box"><div class="data-label">Diametro</div><div class="data-value">${planet.diametro}</div></div>
                        </div>
                        <p>Es un mundo rocoso con una superficie con cráteres similar a la Luna, una delgada atmósfera (exosfera), temperaturas extremas y grandes diferencias entre su lento día solar (176 días terrestres) y su rápido año (88 días terrestres).</p>
                    `;
                } else {
                    visualContent = `<img src="${planetImages.surface_exploration}" alt="Exploración de ${planet.name}">`;
                    infoContent = `
                        <h3>${stage.title} en ${planet.name}</h3>
                        <p>${stage.desc}</p>
                        <p>${planet.desc}</p>
                        <div class="data-grid">
                            <div class="data-box"><div class="data-label">Temperatura</div><div class="data-value">${planet.stats.temp}</div></div>
                            <div class="data-box"><div class="data-label">Tiempo de Viaje</div><div class="data-value">${planet.travelTime}</div></div>
                            <div class="data-box"><div class="data-label">Gravedad</div><div class="data-value">${planet.stats.gravity}</div></div>
                            <div class="data-box"><div class="data-label">Duración Día</div><div class="data-value">${planet.stats.day}</div></div>
                            <div class="data-box"><div class="data-label">Distancia Solar</div><div class="data-value">${planet.distance}</div></div>
                            <div class="data-box"><div class="data-label">Diametro</div><div class="data-value">${planet.diametro}</div></div>
                        </div>
                        <p>Análisis geológico y recolección de muestras de la superficie de ${planet.name}.</p>
                    `;
                }
                // FASE 7: Preparacion Retorno o Exploración en Superficie 
            } else if (state.currentStage === 7) {
                if(planet.id === 'jupiter') {
                 stage.title = "Exploración Superficie con sonda June"; 
                 visualContent = `<img src="${planetImages.return_prep}" alt="Toma de Imagenes desde June al planeta ${planet.name}">`; 
                 infoContent = `<h3>${stage.title} desde ${planet.name}</h3><p>La sonda Juno, lanzada por la NASA en 2016, continua obteniendo datos del planeta ${planet.name}.</p><p>Estos datos permiten estudiar su estructura interna, atmósfera, campos magnéticos y sus vientos, que pueden alcanzar velocidades de hasta 618 kilómetros por hora</p>`; 
                } else  if(planet.id === 'saturn') {
                 stage.title = "Exploración Superficie con sonda Cassini";
                 visualContent = `<img src="${planetImages.return_prep}" alt="Toma de Imagenes desde Cassini al planeta ${planet.name}">`;
                 infoContent = `<h3>${stage.title} desde ${planet.name}</h3><p>La sonda Cassini, lanzada por la NASA en Octubre 1997, continua obteniendo datos del planeta ${planet.name}.</p><p>Cassini descubrió seis nuevas lunas en Saturno, dos nuevos anillos y observó tormentas masivas, incluyendo un vórtice hexagonal en el polo norte.</p>`;  
                } else  if(planet.id === 'mercury') {
                 stage.title = "Exploración Superficie con sonda BepiColombo";
                 visualContent = `<img src="${planetImages.return_prep}" alt="Toma de Imagenes con sondas MMO y MPO al planeta ${planet.name}">`;
                 infoContent = `<h3>${stage.title} desde ${planet.name}</h3><p>La sonda BepiColombo, lanzada en 2018 por la Agencia Espacial Europea (ESA) y la JAXA (Japón), obtiene datos del planeta ${planet.name} como su superficie, interior y campo magnético.</p><p>BepiColombo utiliza propulsión solar-eléctrica y 9 asistencias gravitatorias planetarias.</p>`;  
                }
                else {
                visualContent = `<img src="${planetImages.return_prep}" alt="Preparación para Retorno desde ${planet.name}">`;
                infoContent = `<h3>${stage.title} desde ${planet.name}</h3><p>${stage.desc}</p><p>Preparando nave para el regreso a la Tierra con muestras científicas recolectadas en ${planet.name}.</p><p>Verificando sistemas de propulsión y navegación para el viaje de retorno.</p>`};
                // FASE 8: Despegue de Retorno o Finalizacion Mision Sondas
            } else if (state.currentStage === 8) {
                if(planet.id === 'jupiter' || planet.id === 'saturn' || planet.id === 'mercury') {
                 stage.title = "Finalizacion Mision Exploración"; 
                 visualContent = `<img src="${planetImages.return_launch}" alt="Finalizacion mision en ${planet.name}">`;
                 infoContent = `<h3>${stage.title} en ${planet.name}</h3><p>Descenso a la atmósfera del planeta hacia la órbita baja.</p><p>Entrando en la orbita de ${planet.name}. Se ha planificado que la sonda se desintegre en la atmósfera de ${planet.name}.</p>`; state.currentStage = 12; 
                } else {
                visualContent = `<img src="${planetImages.return_launch}" alt="Despegue de Retorno desde ${planet.name}">`;
                infoContent = `<h3>${stage.title} desde ${planet.name}</h3><p>${stage.desc}</p><p>Abandonando ${planet.name} rumbo a la Tierra. Encendiendo motores para escapar de la gravedad de ${planet.name}.</p>`};
            } else if (state.currentStage === 9) {
                visualContent = `<img src="${MISSION_IMAGES.earth_return}" alt="Regreso a la Tierra">`;
                infoContent = `<h3>${stage.title}</h3><p>${stage.desc}</p><p>Viajando de regreso hacia nuestro planeta azul desde ${planet.name}.</p>`;
            } else if (state.currentStage === 10) {
                visualContent = `<img src="${MISSION_IMAGES.reentry}" alt="Reentrada">`;
                infoContent = `<h3>${stage.title}</h3><p>${stage.desc}</p><p>Escudo térmico protegiendo la nave durante el ingreso atmosférico terrestre.</p>`;
            } else if (state.currentStage === 11) {
                visualContent = `<img src="${MISSION_IMAGES.recovery}" alt="Recuperación">`;
                infoContent = `<h3>${stage.title}</h3><p>${stage.desc}</p><p>Equipos de rescate recuperando la cápsula y al tripulante ${state.astronautName}.</p>`;
            } else if (state.currentStage === 12) {
                visualContent = `<img src="${MISSION_IMAGES.celebration}" alt="Celebración">`;
                infoContent = `
                <h3 class="celebration" style="color: var(--success);">¡CUARENTENA!</h3>
                <div style="background: rgba(0, 255, 157, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid var(--success);">
                <h4 style="color: var(--success); margin-bottom: 0.5rem;">¡Una Instalación Móvil de Cuarentena (MQF), con el tripulante ${state.astronautName}!</h4>
                <p>El tripulante permanecerá en la MQF hasta su llegada al Área de Recepción de Tripulación del Laboratorio luego de su regreso desde ${planet.name}.</p>
                <p>Permanecerá 40 días para desestimar cualquier virus o bacteria que pudiese haber traido.</p>
                </div>
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <i class="fas fa-parade" style="color: var(--primary);"></i>
                    <span style="font-weight: bold;">PRÓXIMO EVENTO:</span>
                </div>
                <p style="font-size: 0.9rem;">Desfile de celebración por la ciudad en honor a ${state.astronautName}, el héroe interplanetario.</p>
                </div>
                `;
            } else if (state.currentStage === 13) {
                visualContent = `<img src="${MISSION_IMAGES.parade}" alt="Celebración">`;
                infoContent = `
                    <h3 class="celebration" style="color: var(--success);">¡MISIÓN CUMPLIDA!</h3>
                    <p>${stage.desc}</p>
                    <div style="background: rgba(0, 255, 157, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid var(--success);">
                        <h4 style="color: var(--success); margin-bottom: 0.5rem;">¡Felicidades ${state.astronautName}!</h4>
                        <p>Has completado exitosamente la misión interplanetaria a ${planet.name}.</p>
                        <p>Tu contribución a la ciencia será recordada por generaciones.</p>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem; margin-top: 1rem;">
                        <i class="fas fa-medal" style="font-size: 2rem; color: gold;"></i>
                        <div>
                            <div style="font-size: 0.9rem; color: var(--text-muted);">RECONOCIMIENTO</div>
                            <div style="color: var(--success); font-weight: bold;">MEDALLA DE HONOR INTERPLANETARIA</div>
                        </div>
                    </div>
                `;
            }

            const stageLabel = state.currentStage > 0 ? `FASE ${state.currentStage}/${STAGES.length - 1}` : 'PRE-LAUNCH';
            const progressPercent = `${Math.round(progress)}%`;

            dom.stageContainer.innerHTML = `
                <div style="display: flex; flex-direction: column; height: 100%;">
                    <div class="stage-content active">
                        <div class="visual-window style="width: 100%; max-width: 100%; height: 600px;">
                            ${visualContent}
                            <div class="visual-overlay">
                                <h2 style="font-family: var(--font-display); color: var(--primary);">${stage.title}</h2>
                                <span style="font-size: 0.9rem; color: #ccc;">CAMARA EN DIRECTO // FEED-${(state.currentStage || 1).toString().padStart(2, '0')}</span>
                            </div>
                        </div>
                        <div class="info-window">
                            ${infoContent}
                            ${state.userImage && state.currentStage > 1 && state.currentStage < (STAGES.length - 1) ? `
                                <div style="margin-top: auto; border: 1px solid var(--glass-border); padding: 10px; border-radius: 8px; display: flex; align-items: center; gap: 10px;">
                                    <img src="${state.userImage}" style="width: 40px; height: 40px; border-radius: 50%;">
                                    <div>
                                        <div style="font-size: 0.8rem; color: var(--text-muted);">TRIPULANTE</div>
                                        <div style="color: var(--success); font-weight: bold;">${state.astronautName.toUpperCase()}</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- CONTROLES DE MISIÓN DEBAJO DEL VISUAL-WINDOW -->
                    <div class="stage-controls-container">
                        <div style="margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase;">Registro de Sistema</div>
                        <div class="system-log" id="stageSystemLog"></div>
                        <div class="mission-controls">
                            <button id="stageBtnLaunch" class="btn" ${state.currentStage > 0 ? 'disabled' : ''}>
                                <i class="fas fa-shuttle-space"></i> ${(state.currentStage - 1) || 0 === 0 ? 'Iniciar Misión' : 'Misión en Curso'}
                            </button>
                            <button id="stageBtnNext" class="btn btn-secondary" ${state.currentStage === 0 || state.currentStage === (STAGES.length - 1) ? 'disabled' : ''}>
                                <i class="fas fa-forward"></i> ${state.currentStage > (STAGES.length - 3) ? 'Finalizar' : 'Siguiente Fase'}
                            </button>
                            <button id="stageBtnReset" class="btn btn-secondary" style="grid-column: span 2;">
                                <i class="fas fa-rotate-left"></i> ${state.currentStage === (STAGES.length - 1) ? 'Nueva Misión' : 'Abortar / Reiniciar'}
                            </button>
                        </div>
                        <div style="margin-top: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-family: var(--font-display); font-size: 0.8rem;">
                                <span id="stageProgressLabel">${stageLabel}</span>
                                <span id="stageProgressPercent">${progressPercent}</span>
                            </div>
                            <div class="progress-track"><div class="progress-fill" id="stageProgressBar" style="width: ${progress}%"></div></div>
                        </div>
                    </div>
                </div>
            `;

            // Inicializar controles del stage
            stageControls = {
                log: document.getElementById('stageSystemLog'),
                btnLaunch: document.getElementById('stageBtnLaunch'),
                btnNext: document.getElementById('stageBtnNext'),
                btnReset: document.getElementById('stageBtnReset'),
                progressBar: document.getElementById('stageProgressBar'),
                progressPercent: document.getElementById('stageProgressPercent'),
                stageLabel: document.getElementById('stageProgressLabel')
            };

            // Configurar event listeners para los nuevos botones
            stageControls.btnLaunch?.addEventListener('click', launchMission);
            stageControls.btnNext?.addEventListener('click', nextStage);
            stageControls.btnReset?.addEventListener('click', resetMission);

            // Limpiar el registro al cambiar de vista
            if (stageControls.log) {
                stageControls.log.innerHTML = '';
                if (state.currentStage > 0) {
                    (state.currentStage > 1) && logStage(`Fase ${state.currentStage-1} completada: ${STAGES[state.currentStage - 1].title}`);
                    (state.currentStage > 1) && logStage(`Iniciando Fase ${state.currentStage}: ${STAGES[state.currentStage].title}`);
                    (state.currentStage == 1) && logStage(`Misión hacia ${planet.name} iniciada.`);
                    (state.currentStage == 1) && logStage(`Tripulante: ${state.astronautName}`);
                    (state.currentStage == 1) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 2) && logStage("Secuencia de ignición iniciada...");
                    (state.currentStage == 2) && logStage(`¡DESPEGUE CONFIRMADO! Rumbo a ${state.destination.name}.`);
                    (state.currentStage == 3) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 4) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 5) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 6) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 7) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 8) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 9) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 10) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 11) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 12) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 13) && logStage(`Fase actual: ${stage.title}`);
                    (state.currentStage == 13) && logStage(`Tripulante: ${state.astronautName}`);
                }
            }
        }

        function logStage(message) {
            if (!stageControls.log) return;
            
            const time = new Date().toLocaleTimeString('es-ES', { hour12: false });
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
            stageControls.log.appendChild(entry);
            stageControls.log.scrollTop = stageControls.log.scrollHeight;
        }

        function setupEventListeners() {
            dom.inputFace.addEventListener('change', handleImageUpload);
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>